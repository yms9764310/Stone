<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <META HTTP-EQUIV="pragma" CONTENT="no-cache">
    <META HTTP-EQUIV="Cache-Control" CONTENT="no-cache, must-revalidate">
    <META HTTP-EQUIV="expires" CONTENT="0">
    <link rel="stylesheet" href="assets/css/layui.css">
    <link rel="stylesheet" href="assets/css/admin.css">
    <link rel="icon" href="/favicon.ico">
    <title>管理后台</title>
</head>
<body class="layui-layout-body">j
<div class="layui-layout layui-layout-admin">
    <div class="layui-header custom-header">

        <ul class="layui-nav layui-layout-left">
            <li class="layui-nav-item slide-sidebar" lay-unselect>
                <a href="javascript:;" class="icon-font"><i class="ai ai-menufold"></i></a>
            </li>
        </ul>

        <ul class="layui-nav layui-layout-right">
            <li class="layui-nav-item">
                <a href="javascript:;">BieJun</a>
                <dl class="layui-nav-child">
                    <dd><a href="">帮助中心</a></dd>
                    <dd><a href="person/changeMessage.html">修改资料</a></dd>
                    <dd><a href="person/changePassword.html">修改密码</a></dd>
                    <dd><a href="../../logout" class="signOut">退出</a></dd>
                </dl>
            </li>
        </ul>
    </div>

    <div class="layui-side custom-admin">
        <div class="layui-side-scroll">

            <div class="custom-logo">
                <img src="assets/images/logo.png" alt=""/>
                <h1>Admin Pro</h1>
            </div>
            <ul id="Nav" class="layui-nav layui-nav-tree">
                <li class="layui-nav-item">
                    <a href="javascript:;">
                        <i class="layui-icon">&#xe609;</i>
                        <em>主页</em>
                    </a>
                    <dl class="layui-nav-child">
                        <dd><a href="views/console.html">控制台</a></dd>
                    </dl>
                </li>
                <li class="layui-nav-item">
                    <a href="javascript:;">
                        <i class="layui-icon">&#xe857;</i>
                        <em>组件</em>
                    </a>
                    <dl class="layui-nav-child">
                        <dd><a href="views/form.html">表单</a></dd>
                        <dd>
                            <a href="javascript:;">页面</a>
                            <dl class="layui-nav-child">
                                <dd>
                                    <a href="login.html">登录页</a>
                                </dd>
                            </dl>
                        </dd>
                    </dl>
                </li>
                <li class="layui-nav-item">
                    <a href="javascript:;">
                        <i class="layui-icon">&#xe612;</i>
                        <em>用户</em>
                    </a>
                    <dl class="layui-nav-child">
                        <dd><a href="person/staffSetting.html">人员设置</a></dd>
                        <dd><a href="person/assignmentWork.html">分配工作</a></dd>
                        <dd><a href="person/toDoList.html">查看工作列表</a></dd>
                        <dd><a href="person/viewWorkProgress.html">查看工作进度</a></dd>
                        <dd><a href="person/viewWorkflow.html">查看工作流记录</a></dd>
                        <dd><a href="person/logManagement.html">日志管理</a></dd>
                    </dl>
                </li>

                <li class="layui-nav-item">
                    <a href="javascript:;">
                        <i class="layui-icon">&#xe612;</i>
                        <em>库存模块</em>
                    </a>
                    <dl class="layui-nav-child">
                        <dd><a href="store/storeStock.html">仓库库存</a></dd>
                        <dd><a href="store/storeManagement.html">仓库盘点</a></dd>
                        <dd><a href="store/reportStatistics.html">报表统计</a></dd>
                        <dd><a href="person/storePutList.html">出/入库审核</a></dd>
                        <dd><a href="store/reportCheckOut.html">出/入库记录查询</a></dd>
                    </dl>
                </li>

                <li class="layui-nav-item">
                    <a href="javascript:;">
                        <i class="layui-icon">&#xe612;</i>
                        <em>私信通知</em>
                    </a>
                    <dl class="layui-nav-child">
                        <dd><a href="message/noticeList.html">通知列表</a></dd>
                        <dd><a href="message/toDoNotice.html">工作通知</a></dd>
                        <dd><a href="message/auditNotice.html">审核通知</a></dd>
                        <dd><a href="message/endNotice.html">完结通知</a></dd>
                    </dl>
                </li>

                <li class="layui-nav-item">
                    <a href="javascript:;">
                        <i class="layui-icon">&#xe612;</i>
                        <em>系统模块</em>
                    </a>
                    <dl class="layui-nav-child">
                        <dd><a href="tSysDepartment/allDemp.html">部门管理</a></dd>
                        <dd><a href="tSysPurchaseProduct/allProu.html">采购商品管理</a></dd>
                        <dd><a href="tSysRole/allRole.html">角色管理</a></dd>
                        <dd><a href="tSysUser/allUser.html">人员管理</a></dd>
                        <dd><a href="permission/allPermission.html">权限补充</a></dd>
                    </dl>
                </li>
                <li class="layui-nav-item">
                    <a href="javascript:;">
                        <i class="layui-icon">&#xe612;</i>
                        <em>账户管理</em>
                    </a>
                    <dl class="layui-nav-child">
                        <dd><a href="person/changePassword.html">修改密码</a></dd>
                        <dd><a href="person/changeMessage.html">修改资料</a></dd>
                    </dl>
                </li>
                <li class="layui-nav-item">
                    <a href="javascript:;">
                        <i class="layui-icon">&#xe613;</i>
                        <em>采购模块</em>
                    </a>
                    <dl class="layui-nav-child">
                        <dd><a href="ProcurementModule/purchaseSupplier.html">供应商管理</a></dd>
                        <dd><a href="ProcurementModule/purchaseBill.html">采办事项</a></dd>
                        <dd><a href="ProcurementModule/productFind.html">商品查询</a></dd>
                        <dd><a href="ProcurementModule/purchaseOrders.html">采购单</a></dd>
                        <dd><a href="ProcurementModule/purchaseHistory.html">采购历史记录</a></dd>
                        <dd><a href="ProcurementModule/purchaseCount.html">月报表统计</a></dd>
                        <dd><a href="ProcurementModule/purchaseCountYear.html">年报表统计</a></dd>
                        <dd><a href="sale/saleCustomer.html">客户信息</a></dd>
                    </dl>
                </li>
                <li class="layui-nav-item">
                    <a href="javascript:;">
                        <i class="layui-icon">&#xe613;</i>
                        <em>销售模块</em>
                    </a>
                    <dl class="layui-nav-child">
                        <dd><a href="views/operaterule.html">权限配置</a></dd>
                        <dd><a href="sale/saleCustomer.html">客户管理</a></dd>
                        <dd><a href="sale/saleBill.html">销售订单管理</a></dd>
                    </dl>
                </li>
                <li class="layui-nav-item">
                    <a href="javascript:;">
                        <i class="layui-icon">&#xe612;</i>
                        <em>生产模块</em>
                    </a>
                    <dl class="layui-nav-child">
                        <dd><a href="views/t_listproduct.html">商品总列表</a></dd>
                        <dd><a href="views/t_listProductBom.html">配方管理</a></dd>
                        <dd><a href="views/t_listProductTask.html">生产任务</a></dd>
                    </dl>
                </li>
                <li class="layui-nav-item">
                    <a href="javascript:;">
                        <i class="layui-icon">&#xe612;</i>
                        <em>财务模块</em>
                    </a>
                    <dl class="layui-nav-child">

                        <dd><a href="finance/allPay.html">应付单</a></dd>
                        <dd><a href="finance/Payment.html">付账单</a></dd>
                        <dd><a href="finance/allReceivables.html">应收单</a></dd>
                        <dd><a href="finance/Receipt.html">付款单</a></dd>
                        <dd><a href="finance/AccountStatement.html">对账单</a></dd>
                        <dd><a href="finance/PaymentReport.html">季/年收款报表统计</a></dd>
                        <dd><a href="finance/ReportForm.html">季/年付款报表统计</a></dd>
                    </dl>
                </li>
            </ul>

        </div>
    </div>

        <div class="layui-body">
             <div class="layui-tab app-container" lay-allowClose="true" lay-filter="tabs">
                <ul id="appTabs" class="layui-tab-title custom-tab"></ul>
                <div id="appTabPage" class="layui-tab-content"></div>
            </div>
        </div>
        <div class="mobile-mask"></div>
    </div>
    <script src="assets/layui.js"></script>
    <script type="text/javascript" src="assets/lay/modules/jquery.js"></script>
    <script src="index.js" data-main="home"></script>
<script>
    layui.config({
        base: "assets/lay/modules/mods/"
    }).use("mods", function (mods) {
        //初始化消息组件
        mods(["layer", "jsanNotice"], function (layer) {
            const notice = layer.noticeMarker({
                "elem": "#noticeMarker",
                "positionX": "right",
                "positionY": "100px",
                "lowKey": false,
                "noticeWindow": {
                    "type": 1,
                    "title": "消息",
                    "classType": {"notice": "通知"},
                   // "classType": {"notice": "通知", "alerted": "预警", "other": "其他"},
                    "width": "300px",
                    "height": "720px",
                    "contentWidth": "80%",
                    "contentHeight": "65%"
                }
            });
            $(function () {
                $.ajax({type: "post",
                    url: "/Stone/Message/findNoReadList.do",
                    data:{},
                    dataType: "json",
                    success: function(result){
                        var newurl =''
                        // alert(JSON.stringify(result.data.message_type))
                        // alert(JSON.stringify(result.data.message_content))

                        for(var i=0;i<result.data.length;i++){
                            if(result.data[i].message_type.search("待审核")!=-1){
                                newurl="person/toDoList.html"
                            }else if(result.data[i].message_type.search("完结")!=-1){
                                newurl="message/endNotice.html"
                            }else if(result.data[i].message_type.search("工作分配")!=-1){
                                newurl="person/upComing.html"
                            }else if(result.data[i].message_type.search("审核结果")!=-1){
                                newurl="message/auditNotice.html"
                            }
                        notice.addNews({
                            "lowKey": false,
                            "classTypeId": "notice",
                            "content": [{"title": result.data[i].message_type, "content": result.data[i].message_content, "date":new Date(), "url": newurl}
                            ]
                        });

                        }
                    }
                })
            });
            $(function () {
                // 创建网页的socket对象
                var ws = null;

                if ("WebSocket" in window) {
                    //alert('支持websocket');
                    ws = new WebSocket("ws://localhost:8080/Stone/websocket/socketServer.do");
                }
                // 当请求打开
                ws.onopen =  (event) =>{
                    console.log(event);
                };
                //得到消息
                // 后台有向前台发送消息会触发
                ws.onmessage = function (ev) {
                    //消息数据在ev的data中
                    console.log(ev.data);
                    // 实现更改消息
                    console.info(ev.data.search("成功")!=-1);
                    console.info(ev.data.search("失败")!=-1);
                    var newurl =''
                    if(ev.data.search("审核")!=-1){
                        newurl="person/toDoList.html"
                    }else if(ev.data.search("驳回")!=-1){
                        newurl="person/upComing.html"
                    }else if(ev.data.search("待完成")!=-1){
                        newurl="person/upComing.html"
                    }
                    //alert(ev.data);
                    notice.addNews({
                        "lowKey": false,
                        "classTypeId": "notice",
                        "content": [{"title": "【通知】消息", "content": ev.data, "date":new Date(), "url": newurl}
                        ]
                    });
                }

            })
            //手动推送新消息，在使用消息组件自带的消息窗口时使用
            // notice.addNews({
            //     "lowKey": true,
            //     "classTypeId": "notice",
            //     "content": [{"title": "【通知】一条来自测试的消息消息消息消息消息消息消息消息消息", "content": "一条来自测试的消息，最多20字，最多20字，最多20字，最多20字，最多20字，最多20字", "date": "2019-07-28 19:30:36", "url": "https://www.baidu.com"}
            //     ]
            // });

            //手动进行消息盒子提醒，通常用于自定义消息窗口的时候使用
            notice.remind({
                "lowKey": false
            });
        });
    });
</script>
</body>
</html>
